<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>School Marksheet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Poppins,Arial;background:linear-gradient(120deg,#a1c4fd,#c2e9fb);padding:10px;}
.container{max-width:1100px;margin:auto;background:#fff;padding:15px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.3);}
.school-header{display:flex;align-items:center;border-bottom:3px solid #4f46e5;padding-bottom:12px;flex-wrap:wrap;gap:10px;}
.school-header img{height:60px;}
.school-title{text-align:center;flex:1;}
.school-title h1{margin:0;color:#1e3a8a;font-size:20px;}
.school-title h2{margin:2px 0;font-size:13px;}
.school-title h4{margin-top:4px;font-size:15px;}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;}
label{font-weight:600;font-size:12px;}
input,select{width:100%;padding:5px;border-radius:5px;border:1px solid #ccc;font-size:12px;}
.table-wrap{overflow-x:auto;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{border:1px solid #ccc;padding:4px;text-align:center;font-size:12px;}
th{background:#4f46e5;color:#fff;}
.sub-result{background:#eef2ff;font-weight:600;color:#1e3a8a;font-size:11px;}
.actions{text-align:center;margin-top:15px;}
button{padding:10px 20px;border:none;border-radius:6px;background:#4f46e5;color:#fff;margin:3px;cursor:pointer;font-size:12px;}
.result-box{margin-top:8px;padding:10px;border:2px solid #4f46e5;border-radius:10px;background:#eef2ff;font-size:13px;}
.sign{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-top:30px;text-align:center;}
.line{height:50px;border-bottom:2px solid #000;margin:0 10px;}
.stamp{width:70px;height:70px;border:2px dashed #000;border-radius:50%;margin:5px auto;}
#teacherPass,#teacherLoginBtn{display:inline;}
@media print{
 body,html{margin:0;padding:0;background:#fff;}
 .container{
   width:210mm;height:297mm;
   padding:10mm;
   box-sizing:border-box;
   border-radius:0;
   box-shadow:none;
   page-break-after:always;
 }
 .table-wrap{overflow:visible;}
 .actions button, #teacherPass,#teacherLoginBtn{display:none;}
 h1,h2,h3,h4,p,label{font-size:12px !important;}
 table, th, td{font-size:12px !important; page-break-inside:avoid !important;}
}
/* Table ko chhota aur compact karne ke liye */
table, th, td {
  font-size: 10px;  /* font chhota karo */
  padding: 3px 4px; /* padding kam karo */
}

/* Print ke liye aur compact */
@media print {
  table, th, td {
    font-size: 9px !important;
    padding: 2px 3px !important;
  }
}
/* Table ko chhota aur compact karne ke liye */
table, th, td {
  font-size: 10px;     /* font chhota karo */
  padding: 2px 4px;    /* horizontal aur vertical padding kam karo */
}

/* Columns ko thoda narrow karo */
table th, table td {
  max-width: 50px;     /* column width kam karo */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.table-wrap table:last-of-type {
  width: 100%;
  font-size: 11px;
  border-collapse: collapse;
  text-align: center;
}
.table-wrap table:last-of-type th,
.table-wrap table:last-of-type td {
  border: 1px solid #ccc;
  padding: 4px 6px;
}

/* Print me aur compact */
@media print {
  table, th, td {
    font-size: 9px !important;
    padding: 1px 3px !important;
  }
  table th, table td {
    max-width: 50px !important;
  }
}

</style>
</head>
<body>

<div class="container" id="printArea">

<div class="school-header">
<img src="logo.png">
<div class="school-title">
<h1>Delhi Public Senior Secondary School</h1>
<h2>Near Toll Plaza Chhapar, Mzn, 251307</h2>
<h4>Annual Examination Report Card</h4>
</div>
</div>

<h3>Student Details</h3>
<div class="grid">
<div><label>Name</label><input id="name"></div>
<div><label>Father</label><input id="father"></div>
<div><label>Mother</label><input id="mother"></div>
<div><label>DOB</label><input type="date" id="dob"></div>
<div><label>Roll</label><input id="roll"></div>
<div>
<label>Class</label>
<select id="classSelect">
<option value="">Select</option>
<option>1</option><option>2</option><option>3</option>
<option>4</option><option>5</option><option>6</option>
<option>7</option><option>8</option>
<option>9</option><option>10</option>
</select>
</div>
<div><label>Teacher Name</label><input id="teacherName" disabled></div>
</div>

<h3>Academic Marks</h3>
<div class="table-wrap">
<table>
<tr>
<th>Subject</th><th>PT-1 (30)</th><th>HY (70)</th><th>100</th>
<th>PT-2 (30)</th><th>Annual (70)</th><th>100</th><th>Total</th>
</tr>
<tbody id="subjects"></tbody>
</table>
</div>

<h2>Other Skills / Activities (Grade Only)</h2>
<div class="table-wrap">
<table>
<tr><th>Activity</th><th>PT 1</th><th>PT 2</th></tr>
<tr><td>Attendance</td><td><input id="att_pt1"></td><td><input id="att_pt2"></td></tr>
<tr><td>Discipline</td><td><input id="disc_pt1"></td><td><input id="disc_pt2"></td></tr>
<tr><td>Computer</td><td><input id="comp_pt1"></td><td><input id="comp_pt2"></td></tr>
<tr><td>General Knowledge</td><td><input id="gk_pt1"></td><td><input id="gk_pt2"></td></tr>
<tr><td>Drawing</td><td><input id="Draw_pt1"></td><td><input id="Draw_pt2"></td></tr>
<tr><td>Health & Physical Education</td><td><input id="Hpe_pt1"></td><td><input id="Hpe_pt2"></td></tr>
</table>
</div>

<div class="actions">
<input type="password" id="teacherPass" placeholder="Teacher Password">
<button id="teacherLoginBtn" onclick="teacherLogin()">Login</button>
<button onclick="teacherLogout()">Logout</button>
</div>

<div class="actions">
<button onclick="window.print()">Print</button>
<div class="result-box">
<p><b>Grand Total:</b> <span id="grand">0</span> / 1200</p>
<p><b>Percentage:</b> <span id="percent">0</span>%</p>
<p><b>Grade:</b> <span id="grade">-</span></p>
<p><b>Teacher:</b> <span id="printTeacher">-</span></p>
</div>
<div class="sign">
<div><p>Class Teacher</p><div class="line"></div></div>
<div><p>Principal</p><div class="line"></div></div>
<div><p>School Stamp</p><div class="stamp"></div></div>
</div>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
const subjects=["Hindi","English","Math","EVS/Science","SST","Sanskrit"];
const tbody=document.getElementById("subjects");
const CLASS_PASSWORDS = {"1":"1111","2":"2222","3":"3333","4":"4444","5":"5555","6":"6666","7":"7777","8":"8888","9":"9999","10":"1010"};
const MASTER_PASSWORD = "MASTER@123";

subjects.forEach((s,i)=>{
 tbody.innerHTML+=`
 <tr>
 <td>${s}</td>
 <td><input id="p1${i}" type="number" min="0" max="30"></td>
 <td><input id="hy${i}" type="number" min="0" max="70"></td>
 <td id="t1${i}">0</td>
 <td><input id="p2${i}" type="number" min="0" max="30"></td>
 <td><input id="an${i}" type="number" min="0" max="70"></td>
 <td id="t2${i}">0</td>
 <td id="tot${i}">0</td>
 </tr>
 <tr class="sub-result">
 <td colspan="8" id="res${i}">Result: 0 / 200 | Percentage: 0% | Grade: -</td>
 </tr>`;
});

// helper
function v(id,max){
 let el=document.getElementById(id);
 let val=Number(el.value)||0;
 if(val>max){ el.value=max; val=max; }
 if(val<0){ el.value=0; val=0; }
 return val;
}

function grade(p){
 if(p>=91) return "A1";
 if(p>=81) return "A2";
 if(p>=71) return "B1";
 if(p>=61) return "B2";
 if(p>=51) return "C1";
 if(p>=41) return "C2";
 if(p>=33) return "D";
 return "E";
}

// calculate
function calculate(){
 let grand=0;
 subjects.forEach((_,i)=>{
  let t1=v("p1"+i,30)+v("hy"+i,70);
  let t2=v("p2"+i,30)+v("an"+i,70);
  let tot=t1+t2;
  let per=(tot/200*100).toFixed(2);
  document.getElementById("t1"+i).innerText=t1;
  document.getElementById("t2"+i).innerText=t2;
  document.getElementById("tot"+i).innerText=tot;
  document.getElementById("res"+i).innerText=
   `Result: ${tot} / 200 | Percentage: ${per}% | Grade: ${grade(per)}`;
  grand+=tot;
 });
 let per=(grand/1200*100).toFixed(2);
 document.getElementById("grand").innerText=grand;
 document.getElementById("percent").innerText=per;
 document.getElementById("grade").innerText=grade(per);
 document.getElementById("printTeacher").innerText=document.getElementById("teacherName").value || "-";
}

// storage
function storageKey(){
 let c=document.getElementById("classSelect").value || "X";
 let r=document.getElementById("roll").value || "X";
 return "MARKSHEET_"+c+"_"+r;  // ये हर student/class के लिए unique key
}

function saveNow(){
    const cls = document.getElementById("classSelect").value;
    if(!cls){ alert("Select class"); return; }

    const data = [];
    subjects.forEach((_, i) => {
        let t1 = v("p1"+i,30) + v("hy"+i,70);
        let t2 = v("p2"+i,30) + v("an"+i,70);
        data.push(t1 + t2); // total marks per subject
    });

    // class-wise key
    localStorage.setItem(cls+"_data", JSON.stringify(data));
    alert("Class " + cls + " data saved!");
}

function loadData(){
 const d=JSON.parse(localStorage.getItem(storageKey()));
 if(!d) return;
 Object.keys(d).forEach(id=>{
  if(document.getElementById(id))
   document.getElementById(id).value=d[id];
 });
 calculate();
}

// clear
function clearAll(){
 if(confirm("Clear this student's data?")){
  localStorage.removeItem(storageKey());
  location.reload();
 }
}

// lock/unlock fields
function lockAll(lock=true){
 document.querySelectorAll("input,select").forEach(i=>{
   if(i.id !== "classSelect") i.disabled = lock;
 });
 document.getElementById("teacherPass").disabled = false;
 document.getElementById("teacherName").disabled = true;
}

// login
function teacherLogin(){
 const cls = document.getElementById("classSelect").value;
 const pass = document.getElementById("teacherPass").value;

 if(!cls){
   alert("Select class first");
   return;
 }

 if(pass === MASTER_PASSWORD || pass === CLASS_PASSWORDS[cls]){
   lockAll(false);
   document.getElementById("teacherPass").style.display="none";
   document.getElementById("teacherLoginBtn").style.display="none";
   document.getElementById("teacherName").disabled = false;
   alert("Login Successful");
   loadData();
 } else {
   alert("Wrong password");
 }
}

// logout
function teacherLogout(){
 lockAll(true);
 document.getElementById("teacherPass").style.display="inline";
 document.getElementById("teacherLoginBtn").style.display="inline";
 alert("Logged Out");
}

// export
function exportExcel(){
 let wb=XLSX.utils.book_new();
 let data = {};
 document.querySelectorAll("input,select").forEach(i=>{
  if(i.id) data[i.id] = i.value;
 });
 let ws = XLSX.utils.json_to_sheet([data]);
 XLSX.utils.book_append_sheet(wb,ws,"Student");
 XLSX.writeFile(wb,"Student.xlsx");
}

function exportPDF(){
 html2pdf().from(document.getElementById("printArea")).set({
  filename: 'Student.pdf',
  pagebreak: {mode:['avoid-all','css']},
  html2canvas: {scale:1}
 }).save();
}

// init
window.onload = () => { lockAll(true); loadData(); }

// auto-calculate on input
document.addEventListener("input", e => { if(!document.getElementById("teacherPass").style.display || document.getElementById("teacherPass").style.display=="none") calculate(); });
</script>
</body>
</html>
