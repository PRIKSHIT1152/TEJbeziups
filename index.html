<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>School Marksheet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:'Poppins',Arial,sans-serif;background:linear-gradient(120deg,#a1c4fd,#c2e9fb);padding:10px;}
.container{max-width:1100px;margin:auto;background:#fff;padding:20px;border-radius:15px;box-shadow:0 8px 25px rgba(0,0,0,.3);}
.school-header{display:flex;align-items:center;justify-content:space-between;border-bottom:3px solid #4f46e5;padding-bottom:15px;gap:10px;flex-wrap:wrap;}
.school-header img{height:80px;}
.school-title{flex:1;text-align:center;}
.school-title h1{margin:0;color:#1e3a8a;font-size:32px;}
.school-title h2{margin:2px 0;font-size:20px;}
.school-title h4{margin-top:5px;font-size:16px;}
.student-details{display:flex;gap:15px;margin-bottom:15px;}
.student-details .info{flex:2;display:flex;gap:15px;}
.student-details .info div{flex:1;display:flex;flex-direction:column;gap:6px;}
.student-details label{font-weight:600;font-size:16px;}
.student-details input{padding:6px;border:1px solid #ccc;border-radius:5px;font-size:14px;}
.photo-box{width:140px;text-align:center;}
.photo-box img{width:140px;height:150px;border:1px solid #000;object-fit:cover;}
.photo-box input{margin-top:3px;font-size:10px;}
.table-wrap{overflow-x:auto;}
table{width:100%;border-collapse:collapse;margin-top:15px;min-width:600px;}
th,td{border:1px solid #ccc;padding:7px;text-align:center;font-size:18px;}
th{background:#4f46e5;color:#fff;}
table input{width:60px;padding:4px;text-align:center;}
.actions{display:flex;justify-content:center;gap:15px;margin-top:25px;flex-wrap:wrap;}
button{padding:12px 30px;border:none;border-radius:8px;background:#4f46e5;color:#fff;font-size:16px;cursor:pointer;}
button:hover{background:#3730a3;}
.signature-container{display:flex;gap:25px;margin-top:100px;flex-wrap:wrap;}
.result-box{
  width:220px;
  border:2px solid #4f46e5;
  margin-top:-60px;   /* ‚Üê yaha control hai */
  border-radius:12px;
  background:#eef2ff;
  padding:15px;
  font-weight:600;
  text-align:center;
}
.sign{flex:1;display:grid;grid-template-columns:repeat(2,1fr);gap:20px;}
.sign-box{text-align:center;}
.footer{text-align:center;margin-top:2px;font-size:13px;color:#555;}
@media(max-width:768px){.student-details{flex-direction:column;}.student-details .info{flex-direction:column;}.photo-box{margin:auto;}.sign{grid-template-columns:1fr;}table{min-width:600px;}}
@media print{button,input[type=file]{display:none;}input{border:none;}}
</style>
</head>
<body>
<div class="container" id="printArea">

<!-- HEADER -->
<div class="school-header">
<img src="logo.png" alt="School Logo">
<div class="school-title">
<h1>Delhi Public Senior Secondary School</h1>
<h2>Near Toll Plaza Chhapar, Mzn ‚Äì 251307 | 9997175372</h2>
<h2>Email: thedelhipublicsrsecschool@gmail.com</h2>
<h4>Annual Examination Report Card</h4>
</div>
</div>

<!-- STUDENT DETAILS -->
<h3>Student Details</h3>
<div class="student-details">
<div class="info">
<div>
<label>Name</label><input type="text" id="sname">
<label>Mother</label><input type="text" id="mname">
<label>Father</label><input type="text" id="fname">
</div>
<div>
<label>Roll No.</label>
<input type="text" id="roll">

<label>Class</label>
<input type="text" id="classShow">

<label>DOB</label>
<input type="date" id="dob">

</div>
</div>
<div class="photo-box">
<img id="photoPreview" src="">
<input type="file" accept="image/*" onchange="loadPhoto(event)">
<div>Student Photo</div>
</div>
</div>

<!-- MARKS TABLE -->
<h3>Academic Marks</h3>
<div class="table-wrap">
<table>
  <tr>
    <h2>
    <th>Scholastic</th>
    <th>Term I</th>
    <th>Term II</th>
    <th>Overall</th>
  <tr>
  <td>Subject</td>
  <td>PT1</td>
  <td>HY</td>
  <td>MM</td>
  <td>PT1+HY</td>
  <td>Grade</td>
  <td>PT2</td>
  <td>AN</td>
  <td>MM</td>
  <td>PT2+AN</td>
  <td>Grade</td>
  <td>M.M</td>
  <td>Total</td>
  <td>Grade</dh>
  </h2>
</tr>
<tbody id="subjects"></tbody>
</table>
</div>

<h2>Other Skills / Activities (Grade Only)</h2>
<div class="table-wrap">
<table>
<tr><th>Activity</th><th>PT1</th><th>PT2</th></tr>
<tr><td>Attendance</td><td><input id="att_pt1"></td><td><input id="att_pt2"></td></tr>
<tr><td>Discipline</td><td><input id="disc_pt1"></td><td><input id="disc_pt2"></td></tr>
<tr><td>Computer</td><td><input id="comp_pt1"></td><td><input id="comp_pt2"></td></tr>
<tr><td>General Knowledge</td><td><input id="gk_pt1"></td><td><input id="gk_pt2"></td></tr>
<tr><td>Drawing</td><td><input id="Draw_pt1"></td><td><input id="Draw_pt2"></td></tr>
<tr><td>Health & Physical Education</td><td><input id="Hpe_pt1"></td><td><input id="Hpe_pt2"></td></tr>
</table>
</div>

<div class="actions">
  <button onclick="calculate()">Calculate</button>
  <button onclick="saveDataFirebase()">Save</button>  <!-- Firebase save -->
  <button onclick="loadDataFirebase()">Open</button>  <!-- Firebase load -->
  <button onclick="window.print()">Print</button>
</div>

<div class="signature-container">
<div class="result-box">
<p>Grand Total: <span id="grand">0</span>/1200</p>
<p>Percentage: <span id="percent">0</span>%</p>
<p>Grade: <span id="grade">-</span></p>
</div>
<div class="sign">
<div class="sign-box">
<p>Class Teacher</p>
</div>
<div class="sign-box">
<p>Principal</p>
</div>
</div>
</div>
<div class="footer">Made by <b>TejbuziUPS</b></div>
</div>
  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { 
  getStorage, 
  ref, 
  uploadBytes, 
  getDownloadURL 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyAiky3fZI3uXeBzuxcfMzmqZKcf4PYlhJg",
  authDomain: "marksheet-2b925.firebaseapp.com",
  projectId: "marksheet-2b925",
  storageBucket: "marksheet-2b925.appspot.com",
  messagingSenderId: "451257976550",
  appId: "1:451257976550:web:e42579664dad9a6f78dd27"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* üîê AUTH */
const auth = getAuth(app);
signInAnonymously(auth)
  .then(() => {
    console.log("Anonymous login success");
  })
  .catch((error) => {
    console.error("Auth error", error);
  });
/* ================= SUBJECTS ================= */
const subjects = ["Hindi","English","Math","Science","SST","Sanskrit"];
const tbody = document.getElementById("subjects");

/* ================= TABLE CREATE ================= */
subjects.forEach((sub, i) => {
  tbody.innerHTML += `
  <tr>
    <td>${sub}</td>
    <td><input type="number" id="p1${i}" max="30" oninput="limit(this,30)"></td>
    <td><input type="number" id="hy${i}" max="70" oninput="limit(this,70)"></td>
    <td>100</td>
    <td id="ph_total${i}">0</td>
    <td id="ph_grade${i}">-</td>

    <td><input type="number" id="p2${i}" max="30" oninput="limit(this,30)"></td>
    <td><input type="number" id="an${i}" max="70" oninput="limit(this,70)"></td>
    <td>100</td>
    <td id="pa_total${i}">0</td>
    <td id="pa_grade${i}">-</td>
     <td>200</td>
    <td id="tot${i}">0</td>
    <td id="tot_grade${i}">-</td>
  </tr>`;
});

/* ================= LIMIT ================= */
window.limit = function(input, max){
  let v = Number(input.value || 0);
  if(v > max) input.value = max;
  if(v < 0) input.value = 0;
  calculate();
};

/* ================= HELPER ================= */
function val(id){
  return Number(document.getElementById(id)?.value || 0);
}

/* ================= GRADE ================= */
function grade(m){
  if(m >= 91) return "A1";
  if(m >= 81) return "A2";
  if(m >= 71) return "B1";
  if(m >= 61) return "B2";
  if(m >= 51) return "C1";
  if(m >= 41) return "C2";
  if(m >= 33) return "D";
  return "E";
}

/* ================= CALCULATE ================= */
window.calculate = function(){
  let grand = 0;

  subjects.forEach((_, i)=>{
    let ph = Math.min(val("p1"+i) + val("hy"+i), 100);
    let pa = Math.min(val("p2"+i) + val("an"+i), 100);
    let total = ph + pa;

    document.getElementById("ph_total"+i).innerText = ph;
    document.getElementById("ph_grade"+i).innerText = grade(ph);

    document.getElementById("pa_total"+i).innerText = pa;
    document.getElementById("pa_grade"+i).innerText = grade(pa);

    document.getElementById("tot"+i).innerText = total;
    document.getElementById("tot_grade"+i).innerText = grade((total/200)*100);

    grand += total;
  });

  let percent = ((grand/(subjects.length*200))*100).toFixed(2);
  document.getElementById("grand").innerText = grand + "/" + (subjects.length*200);
  document.getElementById("percent").innerText = percent;
  document.getElementById("grade").innerText = grade(percent);
};

/* ================= PHOTO PREVIEW ================= */
let selectedPhoto = null;

window.loadPhoto = function(event){
  selectedPhoto = event.target.files[0];
  if(selectedPhoto){
    document.getElementById("photoPreview").src =
      URL.createObjectURL(selectedPhoto);
  }
};

/* ================= SAVE ================= */
window.saveDataFirebase = async function(){
  try {
    const roll = document.getElementById("roll").value.trim();
    if(!roll){
      alert("‚ùå Roll No required");
      return;
    }

    let photoURL = "";

    if(selectedPhoto){
      const photoRef = ref(storage, `studentPhotos/${roll}.jpg`);
      await uploadBytes(photoRef, selectedPhoto);
      photoURL = await getDownloadURL(photoRef);
    }

    const marksData = [];
    subjects.forEach((s,i)=>{
      let ph = Math.min(val("p1"+i)+val("hy"+i),100);
      let pa = Math.min(val("p2"+i)+val("an"+i),100);
      marksData.push({
        subject:s,
        pt1:val("p1"+i),
        hy:val("hy"+i),
        pt2:val("p2"+i),
        an:val("an"+i),
        total: ph + pa
      });
    });

    let grandTotal = marksData.reduce((a,b)=>a+b.total,0);
    let percent = ((grandTotal/(subjects.length*200))*100).toFixed(2);

    const studentInfo = {
      name: document.getElementById("sname").value,
      father: document.getElementById("fname").value,
      mother: document.getElementById("mname").value,
      class: document.getElementById("classShow").value,
      dob: document.getElementById("dob").value,
      photo: photoURL
    };

    await setDoc(doc(db,"results",roll),{
      student: studentInfo,
      marksData,
      grandTotal,
      percent,
      grade: grade(percent)
    });

    alert("‚úÖ Record Saved Successfully!");

  } catch (err) {
    console.error(err);
    alert("‚ùå Save Failed! Check console.");
  }
};

/* ================= LOAD ================= */
window.loadDataFirebase = async function(){
  const roll = document.getElementById("roll").value.trim();
  if(!roll) return alert("Roll No required");

  const snap = await getDoc(doc(db,"results",roll));
  if(!snap.exists()) return alert("No Record");

  const data = snap.data();

  data.marksData.forEach((m,i)=>{
    document.getElementById("p1"+i).value = m.pt1;
    document.getElementById("hy"+i).value = m.hy;
    document.getElementById("p2"+i).value = m.pt2;
    document.getElementById("an"+i).value = m.an;
  });

  if(data.student){
    document.getElementById("sname").value = data.student.name || "";
    document.getElementById("fname").value = data.student.father || "";
    document.getElementById("mname").value = data.student.mother || "";
    document.getElementById("classShow").value = data.student.class || "";
    document.getElementById("dob").value = data.student.dob || "";
    if(data.student.photo){
      document.getElementById("photoPreview").src = data.student.photo;
    }
  }

  calculate();
};
</script>

</body>
</html>
